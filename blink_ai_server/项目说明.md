# 人脸识别聚类服务 - 项目说明

## 项目概述

本项目实现了一个基于InsightFace的人脸识别聚类服务，能够自动检测照片中的人脸并进行智能聚类，识别出不同照片中的同一个人。该服务参考了iPhone和Google相册的人物聚类功能，提供了完整的RESTful API接口。

## 技术架构

### 核心技术栈
- **人脸检测**: InsightFace + ArcFace模型
- **特征提取**: 512维人脸特征向量
- **聚类算法**: DBSCAN (基于余弦相似度)
- **数据存储**: SQLite数据库
- **Web框架**: FastAPI
- **图像处理**: OpenCV + Pillow

### 系统架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   图片上传      │───▶│   人脸检测      │───▶│   特征提取      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   聚类结果      │◀───│   聚类算法      │◀───│   特征存储      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 功能特性

### 1. 人脸检测与特征提取
- 使用InsightFace进行高精度人脸检测
- 提取512维人脸特征向量
- 支持多种图像格式（JPEG、PNG、BMP等）
- 自动处理人脸角度和光照变化

### 2. 智能聚类
- 使用DBSCAN算法进行人脸聚类
- 支持动态阈值调整
- 自动识别噪声点
- 支持增量聚类功能

### 3. 相似度搜索
- 基于余弦相似度的人脸搜索
- 可调节相似度阈值
- 支持批量相似人脸查找

### 4. RESTful API
- 完整的API接口文档
- 支持文件上传和批量处理
- 实时返回聚类结果
- 提供统计信息查询

## 文件结构

```
blink_ai_server/
├── main.py                 # 主程序文件
├── config.py              # 配置文件
├── requirements.txt       # Python依赖
├── README.md             # 使用说明
├── demo.py               # 演示脚本
├── test_client.py        # 测试客户端
├── start.sh              # 启动脚本
├── Dockerfile            # Docker配置
├── docker-compose.yml    # Docker Compose配置
└── 项目说明.md           # 项目说明文档
```

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动服务
```bash
python main.py
# 或者使用启动脚本
./start.sh
```

### 3. 访问服务
- 服务地址: http://localhost:8000
- API文档: http://localhost:8000/docs
- 交互式文档: http://localhost:8000/redoc

### 4. 运行演示
```bash
python demo.py
```

## API接口说明

### 核心接口

1. **POST /detect_faces** - 检测人脸
   - 上传图片文件
   - 返回检测到的人脸信息

2. **POST /cluster_faces** - 执行聚类
   - 对所有已检测的人脸进行聚类
   - 支持参数调整

3. **POST /find_similar** - 查找相似人脸
   - 上传查询图片
   - 返回相似的人脸列表

4. **GET /clusters** - 获取聚类结果
   - 返回当前所有聚类结果

5. **GET /stats** - 获取统计信息
   - 返回人脸和聚类的统计信息

## 配置参数

### 聚类参数
- `eps`: DBSCAN聚类参数，控制聚类的紧密程度 (0.3-0.6)
- `min_samples`: 形成聚类的最小样本数 (2-5)
- `threshold`: 相似度阈值，用于相似人脸搜索 (0.5-0.8)

### 人脸检测参数
- `confidence`: 人脸检测置信度阈值 (0.5)
- `det_size`: 检测图像尺寸 (640, 640)

## 使用场景

### 1. 相册管理
- 自动整理照片中的人物
- 创建人物相册
- 快速查找特定人物的照片

### 2. 安防监控
- 人员身份识别
- 异常行为检测
- 访客管理系统

### 3. 社交应用
- 照片标签自动生成
- 好友推荐
- 内容推荐

## 性能优化

### 1. 模型优化
- 使用GPU加速（如果可用）
- 模型量化减少内存占用
- 批处理提高效率

### 2. 数据库优化
- 索引优化
- 连接池管理
- 定期清理旧数据

### 3. 缓存策略
- 特征向量缓存
- 聚类结果缓存
- 图片缩略图缓存

## 部署方案

### 1. 本地部署
```bash
python main.py
```

### 2. Docker部署
```bash
docker-compose up -d
```

### 3. 生产环境
- 使用Nginx作为反向代理
- 配置SSL证书
- 设置监控和日志

## 注意事项

1. **模型下载**: 首次运行会自动下载InsightFace模型文件
2. **图片质量**: 建议使用高质量、正面的人脸照片
3. **隐私保护**: 人脸特征数据需要妥善保护
4. **性能要求**: 大量图片处理需要足够的计算资源

## 扩展功能

### 1. 人脸识别
- 添加人脸识别功能
- 支持人脸库管理
- 实现身份验证

### 2. 视频处理
- 支持视频文件处理
- 实时人脸检测
- 视频流分析

### 3. 移动端支持
- 开发移动端应用
- 实时拍照识别
- 离线模式支持

## 技术支持

如有问题或建议，请参考：
- API文档: http://localhost:8000/docs
- 项目README: README.md
- 演示脚本: demo.py
